name: Run Model

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  run-model:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v6
      with:
        enable-cache: true

    - name: Decrypt test data
      env:
        GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
      run: |
        # Import the GPG private key from secrets
        echo "$GPG_PRIVATE_KEY" | gpg --import --batch

        # Decrypt the test file
        gpg --decrypt --batch --yes --output data/test.csv data/test.csv.asc

    - name: Run evaluation
      run: uv run evaluate.py

    - name: Commit updated README
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git diff --staged --quiet || git commit -m "üèÜ Update leaderboard"
        git push
